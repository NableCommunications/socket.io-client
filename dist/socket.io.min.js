/*! Socket.IO.min.js build:0.9.6, production. Copyright(c) 2011 LearnBoost <dev@learnboost.com> MIT Licensed */
this.io={},module.exports=this.io,function(a,b){var c=a;c.version="0.9.6",c.protocol=1,c.transports=[],c.j=[],c.sockets={},c.connect=function(a,b){var d=c.util.parseUri(a),e,f;e=c.util.uniqueUri(d);var g={host:d.host,secure:"https"==d.protocol,port:d.port||("https"==d.protocol?443:80),query:d.query||""};c.util.merge(g,b);if(g["force new connection"]||!c.sockets[e])f=new c.Socket(g);return!g["force new connection"]&&f&&(c.sockets[e]=f),f=f||c.sockets[e],f.of(d.path.length>1?d.path:"")}}(this.io,this),function(a,b){var c=a.util={},d=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,e=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];c.parseUri=function(a){var b=d.exec(a||""),c={},f=14;while(f--)c[e[f]]=b[f]||"";return c},c.uniqueUri=function(a){var c=a.protocol,d=a.host,e=a.port;return"document"in b?(d=d||document.domain,e=e||(c=="https"&&document.location.protocol!=="https:"?443:document.location.port)):(d=d||"localhost",!e&&c=="https"&&(e=443)),(c||"http")+"://"+d+":"+(e||80)},c.query=function(a,b){var d=c.chunkQuery(a||""),e=[];c.merge(d,c.chunkQuery(b||""));for(var f in d)d.hasOwnProperty(f)&&e.push(f+"="+d[f]);return e.length?"?"+e.join("&"):""},c.chunkQuery=function(a){var b={},c=a.split("&"),d=0,e=c.length,f;for(;d<e;++d)f=c[d].split("="),f[0]&&(b[f[0]]=f[1]);return b};var f=!1;c.load=function(a){if("document"in b&&document.readyState==="complete"||f)return a();c.on(b,"load",a,!1)},c.on=function(a,b,c,d){a.attachEvent?a.attachEvent("on"+b,c):a.addEventListener&&a.addEventListener(b,c,d)},c.request=function(a){if(a&&"undefined"!=typeof XDomainRequest)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!a||c.ua.hasCORS))return new XMLHttpRequest;if(!a)try{return new(window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(b){}return null},"undefined"!=typeof window&&c.load(function(){f=!0}),c.defer=function(a){if(!c.ua.webkit||"undefined"!=typeof importScripts)return a();c.load(function(){setTimeout(a,100)})},c.merge=function(b,d,e,f){var g=f||[],h=typeof e=="undefined"?2:e,i;for(i in d)d.hasOwnProperty(i)&&c.indexOf(g,i)<0&&(typeof b[i]!="object"||!h?(b[i]=d[i],g.push(d[i])):c.merge(b[i],d[i],h-1,g));return b},c.mixin=function(a,b){c.merge(a.prototype,b.prototype)},c.inherit=function(a,b){function c(){}c.prototype=b.prototype,a.prototype=new c},c.isArray=Array.isArray||function(a){return Object.prototype.toString.call(a)==="[object Array]"},c.intersect=function(a,b){var d=[],e=a.length>b.length?a:b,f=a.length>b.length?b:a;for(var g=0,h=f.length;g<h;g++)~c.indexOf(e,f[g])&&d.push(f[g]);return d},c.indexOf=function(a,b,c){for(var d=a.length,c=c<0?c+d<0?0:c+d:c||0;c<d&&a[c]!==b;c++);return d<=c?-1:c},c.toArray=function(a){var b=[];for(var c=0,d=a.length;c<d;c++)b.push(a[c]);return b},c.ua={},c.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var a=new XMLHttpRequest}catch(b){return!1}return a.withCredentials!=undefined}(),c.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent),c.ua.iDevice="undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)}("undefined"!=typeof io?io:module.exports,this),function(a,b){function c(){}a.EventEmitter=c,c.prototype.on=function(a,c){return this.$events||(this.$events={}),this.$events[a]?b.util.isArray(this.$events[a])?this.$events[a].push(c):this.$events[a]=[this.$events[a],c]:this.$events[a]=c,this},c.prototype.addListener=c.prototype.on,c.prototype.once=function(a,b){function d(){c.removeListener(a,d),b.apply(this,arguments)}var c=this;return d.listener=b,this.on(a,d),this},c.prototype.removeListener=function(a,c){if(this.$events&&this.$events[a]){var d=this.$events[a];if(b.util.isArray(d)){var e=-1;for(var f=0,g=d.length;f<g;f++)if(d[f]===c||d[f].listener&&d[f].listener===c){e=f;break}if(e<0)return this;d.splice(e,1),d.length||delete this.$events[a]}else(d===c||d.listener&&d.listener===c)&&delete this.$events[a]}return this},c.prototype.removeAllListeners=function(a){return this.$events&&this.$events[a]&&(this.$events[a]=null),this},c.prototype.listeners=function(a){return this.$events||(this.$events={}),this.$events[a]||(this.$events[a]=[]),b.util.isArray(this.$events[a])||(this.$events[a]=[this.$events[a]]),this.$events[a]},c.prototype.emit=function(a){if(!this.$events)return!1;var c=this.$events[a];if(!c)return!1;var d=Array.prototype.slice.call(arguments,1);if("function"==typeof c)c.apply(this,d);else{if(!b.util.isArray(c))return!1;var e=c.slice();for(var f=0,g=e.length;f<g;f++)e[f].apply(this,d)}return!0}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(a,b){return"use strict",a.JSON={parse:b.parse,stringify:b.stringify}}("undefined"!=typeof io?io:module.exports,typeof JSON!="undefined"?JSON:undefined),function(a,b){var c=a.parser={},d=c.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],e=c.reasons=["transport not supported","client not handshaken","unauthorized"],f=c.advice=["reconnect"],g=b.JSON,h=b.util.indexOf;c.encodePacket=function(a){var b=h(d,a.type),c=a.id||"",i=a.endpoint||"",j=a.ack,k=null;switch(a.type){case"error":var l=a.reason?h(e,a.reason):"",m=a.advice?h(f,a.advice):"";if(l!==""||m!=="")k=l+(m!==""?"+"+m:"");break;case"message":a.data!==""&&(k=a.data);break;case"event":var n={name:a.name};a.args&&a.args.length&&(n.args=a.args),k=g.stringify(n);break;case"json":k=g.stringify(a.data);break;case"connect":a.qs&&(k=a.qs);break;case"ack":k=a.ackId+(a.args&&a.args.length?"+"+g.stringify(a.args):"")}var o=[b,c+(j=="data"?"+":""),i];return k!==null&&k!==undefined&&o.push(k),o.join(":")},c.encodePayload=function(a){var b="";if(a.length==1)return a[0];for(var c=0,d=a.length;c<d;c++){var e=a[c];b+="\ufffd"+e.length+"\ufffd"+a[c]}return b};var i=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;c.decodePacket=function(a){var b=a.match(i);if(!b)return{};var c=b[2]||"",a=b[5]||"",h={type:d[b[1]],endpoint:b[4]||""};c&&(h.id=c,b[3]?h.ack="data":h.ack=!0);switch(h.type){case"error":var b=a.split("+");h.reason=e[b[0]]||"",h.advice=f[b[1]]||"";break;case"message":h.data=a||"";break;case"event":try{var j=g.parse(a);h.name=j.name,h.args=j.args}catch(k){}h.args=h.args||[];break;case"json":try{h.data=g.parse(a)}catch(k){}break;case"connect":h.qs=a||"";break;case"ack":var b=a.match(/^([0-9]+)(\+)?(.*)/);if(b){h.ackId=b[1],h.args=[];if(b[3])try{h.args=b[3]?g.parse(b[3]):[]}catch(k){}}break;case"disconnect":case"heartbeat":}return h},c.decodePayload=function(a){if(a.charAt(0)=="\ufffd"){var b=[];for(var d=1,e="";d<a.length;d++)a.charAt(d)=="\ufffd"?(b.push(c.decodePacket(a.substr(d+1).substr(0,e))),d+=Number(e)+1,e=""):e+=a.charAt(d);return b}return[c.decodePacket(a)]}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(a,b){function c(a,b){this.socket=a,this.sessid=b}a.Transport=c,b.util.mixin(c,b.EventEmitter),c.prototype.onData=function(a){this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout();if(a!==""){var c=b.parser.decodePayload(a);if(c&&c.length)for(var d=0,e=c.length;d<e;d++)this.onPacket(c[d])}return this},c.prototype.onPacket=function(a){return this.socket.setHeartbeatTimeout(),a.type=="heartbeat"?this.onHeartbeat():(a.type=="connect"&&a.endpoint==""&&this.onConnect(),a.type=="error"&&a.advice=="reconnect"&&(this.open=!1),this.socket.onPacket(a),this)},c.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var a=this;this.closeTimeout=setTimeout(function(){a.onDisconnect()},this.socket.closeTimeout)}},c.prototype.onDisconnect=function(){return this.close&&this.open&&this.close(),this.clearTimeouts(),this.socket.onDisconnect(),this},c.prototype.onConnect=function(){return this.socket.onConnect(),this},c.prototype.clearCloseTimeout=function(){this.closeTimeout&&typeof this.closeTimeout=="number"&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},c.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&typeof this.reopenTimeout=="number"&&clearTimeout(this.reopenTimeout)},c.prototype.packet=function(a){this.send(b.parser.encodePacket(a))},c.prototype.onHeartbeat=function(a){this.packet({type:"heartbeat"})},c.prototype.onOpen=function(){this.open=!0,this.clearCloseTimeout(),this.socket.onOpen()},c.prototype.onClose=function(){var a=this;this.open=!1,this.socket.onClose(),this.onDisconnect()},c.prototype.prepareUrl=function(){var a=this.socket.options;return this.scheme()+"://"+a.host+":"+a.port+"/"+a.resource+"/"+b.protocol+"/"+this.name+"/"+this.sessid},c.prototype.ready=function(a,b){b.call(this)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(a,b,c){function d(a){this.options={port:80,secure:!1,document:"document"in c?document:!1,resource:"socket.io",transports:b.transports,"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":Infinity,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!0,"auto connect":!0,"flash policy port":10843},b.util.merge(this.options,a),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1;if(this.options["sync disconnect on unload"]&&(!this.isXDomain()||b.util.ua.hasCORS)){var d=this;b.util.on(c,"unload",function(){d.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}function e(){}a.Socket=d,b.util.mixin(d,b.EventEmitter),d.prototype.of=function(a){return this.namespaces[a]||(this.namespaces[a]=new b.SocketNamespace(this,a),a!==""&&this.namespaces[a].packet({type:"connect"})),this.namespaces[a]},d.prototype.publish=function(){this.emit.apply(this,arguments);var a;for(var b in this.namespaces)this.namespaces.hasOwnProperty(b)&&(a=this.of(b),a.$emit.apply(a,arguments))},d.prototype.handshake=function(a){function f(b){b instanceof Error?(c.connecting=!1,c.onError(b.message)):a.apply(null,b.split(":"))}var c=this,d=this.options,g=["http"+(d.secure?"s":"")+":/",d.host+":"+d.port,d.resource,b.protocol,b.util.query(this.options.query,"t="+ +(new Date))].join("/"),h=Ti.Network.createHTTPClient();h.open("GET",g,!0),h.withCredentials=!0,h.onreadystatechange=function(){h.readyState==4&&(h.onreadystatechange=e,h.status==200?f(h.responseText):(c.connecting=!1,!c.reconnecting&&c.onError(h.responseText)))},h.send(null)},d.prototype.getTransport=function(a){var c=a||this.transports,d;for(var e=0,f;f=c[e];e++)if(b.Transport[f]&&b.Transport[f].check(this)&&(!this.isXDomain()||b.Transport[f].xdomainCheck()))return new b.Transport[f](this,this.sessionid);return null},d.prototype.connect=function(a){if(this.connecting)return this;var c=this;return c.connecting=!0,this.handshake(function(d,e,f,g){function h(a){c.transport&&c.transport.clearTimeouts(),c.transport=c.getTransport(a);if(!c.transport)return c.publish("connect_failed");c.transport.ready(c,function(){c.connecting=!0,c.publish("connecting",c.transport.name),c.transport.open(),c.options["connect timeout"]&&(c.connectTimeoutTimer=setTimeout(function(){if(!c.connected){c.connecting=!1;if(c.options["try multiple transports"]){c.remainingTransports||(c.remainingTransports=c.transports.slice(0));var a=c.remainingTransports;while(a.length>0&&a.splice(0,1)[0]!=c.transport.name);a.length?h(a):c.publish("connect_failed")}}},c.options["connect timeout"]))})}c.sessionid=d,c.closeTimeout=f*1e3,c.heartbeatTimeout=e*1e3,c.transports=g?b.util.intersect(g.split(","),c.options.transports):c.options.transports,c.setHeartbeatTimeout(),h(c.transports),c.once("connect",function(){typeof c.connectTimeoutTimer=="number"&&clearTimeout(c.connectTimeoutTimer),a&&typeof a=="function"&&a()})}),this},d.prototype.setHeartbeatTimeout=function(){typeof this.heartbeatTimeoutTimer=="number"&&clearTimeout(this.heartbeatTimeoutTimer);var a=this;this.heartbeatTimeoutTimer=setTimeout(function(){a.transport.onClose()},this.heartbeatTimeout)},d.prototype.packet=function(a){return this.connected&&!this.doBuffer?this.transport.packet(a):this.buffer.push(a),this},d.prototype.setBuffer=function(a){this.doBuffer=a,!a&&this.connected&&this.buffer.length&&(this.transport.payload(this.buffer),this.buffer=[])},d.prototype.disconnect=function(){if(this.connected||this.connecting)this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted");return this},d.prototype.disconnectSync=function(){var a=Ti.Network.createHTTPClient(),c=this.resource+"/"+b.protocol+"/"+this.sessionid;a.open("GET",c,!0),this.onDisconnect("booted")},d.prototype.isXDomain=function(){return!1},d.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},d.prototype.onOpen=function(){this.open=!0},d.prototype.onClose=function(){this.open=!1,typeof this.heartbeatTimeoutTimer=="number"&&clearTimeout(this.heartbeatTimeoutTimer)},d.prototype.onPacket=function(a){this.of(a.endpoint).onPacket(a)},d.prototype.onError=function(a){a&&a.advice&&a.advice==="reconnect"&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",a&&a.reason?a.reason:a)},d.prototype.onDisconnect=function(a){var b=this.connected,c=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1;if(b||c)this.transport.close(),this.transport.clearTimeouts(),b&&(this.publish("disconnect",a),"booted"!=a&&this.options.reconnect&&!this.reconnecting&&this.reconnect())},d.prototype.reconnect=function(){function e(){if(a.connected){for(var b in a.namespaces)a.namespaces.hasOwnProperty(b)&&""!==b&&a.namespaces[b].packet({type:"connect"});a.publish("reconnect",a.transport.name,a.reconnectionAttempts)}typeof a.reconnectionTimer=="number"&&clearTimeout(a.reconnectionTimer),a.removeListener("connect_failed",f),a.removeListener("connect",f),a.reconnecting=!1,delete a.reconnectionAttempts,delete a.reconnectionDelay,delete a.reconnectionTimer,delete a.redoTransports,a.options["try multiple transports"]=c}function f(){if(!a.reconnecting)return;if(a.connected)return e();if(a.connecting&&a.reconnecting)return a.reconnectionTimer=setTimeout(f,1e3);a.reconnectionAttempts++>=b?a.redoTransports?(a.publish("reconnect_failed"),e()):(a.on("connect_failed",f),a.options["try multiple transports"]=!0,a.transport=a.getTransport(),a.redoTransports=!0,a.connect()):(a.reconnectionDelay<d&&(a.reconnectionDelay*=2),a.connect(),a.publish("reconnecting",a.reconnectionDelay,a.reconnectionAttempts),a.reconnectionTimer=setTimeout(f,a.reconnectionDelay))}this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var a=this,b=this.options["max reconnection attempts"],c=this.options["try multiple transports"],d=this.options["reconnection limit"];this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(f,this.reconnectionDelay),this.on("connect",f)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(a,b){function c(a,b){this.socket=a,this.name=b||"",this.flags={},this.json=new d(this,"json"),this.ackPackets=0,this.acks={}}function d(a,b){this.namespace=a,this.name=b}a.SocketNamespace=c,b.util.mixin(c,b.EventEmitter),c.prototype.$emit=b.EventEmitter.prototype.emit,c.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},c.prototype.packet=function(a){return a.endpoint=this.name,this.socket.packet(a),this.flags={},this},c.prototype.send=function(a,b){var c={type:this.flags.json?"json":"message",data:a};return"function"==typeof b&&(c.id=++this.ackPackets,c.ack=!0,this.acks[c.id]=b),this.packet(c)},c.prototype.emit=function(a){var b=Array.prototype.slice.call(arguments,1),c=b[b.length-1],d={type:"event",name:a};return"function"==typeof c&&(d.id=++this.ackPackets,d.ack="data",this.acks[d.id]=c,b=b.slice(0,b.length-1)),d.args=b,this.packet(d)},c.prototype.disconnect=function(){return this.name===""?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},c.prototype.onPacket=function(a){function d(){c.packet({type:"ack",args:b.util.toArray(arguments),ackId:a.id})}var c=this;switch(a.type){case"connect":this.$emit("connect");break;case"disconnect":this.name===""?this.socket.onDisconnect(a.reason||"booted"):this.$emit("disconnect",a.reason);break;case"message":case"json":var e=["message",a.data];a.ack=="data"?e.push(d):a.ack&&this.packet({type:"ack",ackId:a.id}),this.$emit.apply(this,e);break;case"event":var e=[a.name].concat(a.args);a.ack=="data"&&e.push(d),this.$emit.apply(this,e);break;case"ack":this.acks[a.ackId]&&(this.acks[a.ackId].apply(this,a.args),delete this.acks[a.ackId]);break;case"error":a.advice?this.socket.onError(a):a.reason=="unauthorized"?this.$emit("connect_failed",a.reason):this.$emit("error",a.reason)}},d.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},d.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(a,b,c){function d(a){b.Transport.apply(this,arguments)}a.websocket=d,b.util.inherit(d,b.Transport),d.prototype.name="websocket",d.prototype.open=function(){var a=b.util.query(this.socket.options.query),c=this,d;return this.websocket=new WebSocket(this.prepareUrl()+a),this.websocket.onopen=function(){c.onOpen(),c.socket.setBuffer(!1)},this.websocket.onmessage=function(a){c.onData(a.data)},this.websocket.onclose=function(){c.onClose(),c.socket.setBuffer(!0)},this.websocket.onerror=function(a){c.onError(a)},this},b.util.ua.iDevice?d.prototype.send=function(a){var b=this;return setTimeout(function(){b.websocket.send(a)},0),this}:d.prototype.send=function(a){return this.websocket.send(a),this},d.prototype.payload=function(a){for(var b=0,c=a.length;b<c;b++)this.packet(a[b]);return this},d.prototype.close=function(){return this.websocket.close(),this},d.prototype.onError=function(a){this.socket.onError(a)},d.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},d.check=function(){return!0},d.xdomainCheck=function(){return!0},b.transports.push("websocket")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this);var SHA1=function(){var a={},b=function(){function b(a){a&=4294967295,a<0&&(a+=4294967296);var b=Number(a).toString(16);return b.length<8&&(b="00000000".substr(0,8-b.length)+b),b}function c(a){var b=a+1+64;return 512*Math.ceil(b/512)/32}function d(a){var b=a.length,d=c(b*8),e=new Array(d),f;for(f=0,j=0;f<b;)e[j++]=(a.charCodeAt(f++)&255)<<24|(a.charCodeAt(f++)&255)<<16|(a.charCodeAt(f++)&255)<<8|a.charCodeAt(f++)&255;while(j<d)e[j++]=0;return e}function e(a,b,c){if(c>4294967295){var d=c&4294967295;d<0&&(d+=4294967296),a[b-1]=d,a[b-2]=(c-d)/4294967296}else a[b-1]=c,a[b-2]=0;return a}function f(a,b){var d=Math.floor(b/32);return a[d]|=1<<(d+1)*32-b-1,e(a,c(b),b),a}function g(a){var b=0,c=0,d=[1732584193,4023233417,2562383102,271733878,3285377520];while(b<a.length){var e=new Array(80);for(c=0;c<16;c++)e[c]=a[b++];for(c=16;c<80;c++){var f=e[c-3]^e[c-8]^e[c-14]^e[c-16];e[c]=f<<1|f>>>31}var g=d[0],h=d[1],i=d[2],j=d[3],k=d[4];for(c=0;c<80;c++){var l=(g<<5|g>>>27)+k+e[c];c>=0&&c<=19?l+=(h&i|~h&j)+1518500249:c>=20&&c<=39?l+=(h^i^j)+1859775393:c>=40&&c<=59?l+=(h&i|h&j|i&j)+2400959708:c>=60&&c<=79&&(l+=(h^i^j)+3395469782),k=j,j=i,i=h<<30|h>>>2,h=g,g=l}d[0]=d[0]+g&4294967295,d[1]=d[1]+h&4294967295,d[2]=d[2]+i&4294967295,d[3]=d[3]+j&4294967295,d[4]=d[4]+k&4294967295,d[0]<0&&(d[0]+=4294967296),d[1]<0&&(d[1]+=4294967296),d[2]<0&&(d[2]+=4294967296),d[3]<0&&(d[3]+=4294967296),d[4]<0&&(d[4]+=4294967296)}return d}function i(a){a&=255,a<0&&(a+=256);var b=Number(a).toString(16);return b.length<2&&(b="00".substr(0,2-b.length)+b),b}var a;a={enabled:!0,equals:function(b,c){var d;if(b instanceof Array&&c instanceof Array){if(b.length!==c.length)return!1;for(d=0;d<b.length;d++)if(!a.equals(b[d],c[d]))return!1;return!0}if(b!==null&&c!==null&&typeof b=="object"&&typeof c=="object"){for(d in b)if(b.hasOwnProperty(d)&&!a.equals(b[d],c[d]))return!1;return!0}return b===c},should:function(b,c){a.currentIndicator++;if(!b){var d=["[Spec failed",a.currentTitle?" ("+a.currentTitle+")] ":"] ",c||a.currentMessage+" "+a.currentIndicator||""].join("");throw alert(d),d}return!!b},describe:function(b,c){a.currentTitle=b;var d;for(d in c)c.hasOwnProperty(d)&&(a.currentMessage=d,a.currentIndicator=0,c[d](),a.currentIndicator=null);a.currentMessage=a.currentTitle=null},Version:"0.1"},a.should.equal=function(b,c,d){return a.should(a.equals(b,c),d)},a.should.not=function(b,c){return a.should(!b,c)},a.should.not.equal=function(b,c,d){return a.should(!a.equals(b,c),d)},a.enabled||(a.describe=function(){}),a.describe("Spec object",{should:function(){a.should(!0),a.should(1)},"should.not":function(){a.should.not(!1),a.should.not(0)},"should.equal":function(){a.should.equal(null,null),a.should.equal("",""),a.should.equal(12345,12345),a.should.equal([0,1,2],[0,1,2]),a.should.equal([0,1,[0,1,2]],[0,1,[0,1,2]]),a.should.equal({},{}),a.should.equal({x:1},{x:1}),a.should.equal({x:[1]},{x:[1]})},"should.not.equal":function(){a.should.not.equal([1,2,3],[1,2,3,4]),a.should.not.equal({x:1},[1,2,3,4])}}),a.describe("sha1",{strfhex32:function(){a.should.equal(b(0),"00000000"),a.should.equal(b(291),"00000123"),a.should.equal(b(4294967295),"ffffffff")}}),a.describe("sha1",{padding_size:function(){a.should.equal(c(0),16),a.should.equal(c(1),16),a.should.equal(c(447),16),a.should.equal(c(448),32)}}),a.describe("sha1",{word_array:function(){a.should.equal(d(""),[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),a.should.equal(d("1234")[0],825373492)}}),a.describe("sha1",{write_nbits:function(){a.should.equal(e([0,0],2,1),[0,1]),a.should.equal(e([0,0],2,4294967295),[0,4294967295]),a.should.equal(e([0,0],2,4294967296),[1,0]),a.should.equal(e([0,0],2,8589934591),[1,4294967295]),a.should.equal(e([0,0],2,1249835483136),[291,0]),a.should.equal(e([0,0],2,1252717883154),[291,2882400018])}});var h=function(a){this.message=a};return _base64_keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",h.prototype={digest:function(){var a=this.message.length*8,b=f(d(this.message),a);return g(b)},base64digest:function(){var a=this.hexdigest(),b="",c,d,e,f,g,h,i,j=0;while(j<a.length)c=parseInt(a.substring(j,j+2),16),d=parseInt(a.substring(j+2,j+4),16),e=parseInt(a.substring(j+4,j+6),16),f=c>>2,g=(c&3)<<4|d>>4,h=(d&15)<<2|e>>6,i=e&63,isNaN(d)?h=i=64:isNaN(e)&&(i=64),b=b+_base64_keyStr.charAt(f)+_base64_keyStr.charAt(g)+_base64_keyStr.charAt(h)+_base64_keyStr.charAt(i),j+=6;return b},hexdigest:function(){var a=this.digest(),c;for(c=0;c<a.length;c++)a[c]=b(a[c]);return a.join("")}},a.describe("sha1",{"SHA1#hexdigest":function(){a.should.equal((new h("")).hexdigest(),"da39a3ee5e6b4b0d3255bfef95601890afd80709"),a.should.equal((new h("1")).hexdigest(),"356a192b7913b04c54574d18c28d46e6395428ab"),a.should.equal((new h("Hello.")).hexdigest(),"9b56d519ccd9e1e5b2a725e186184cdc68de0731"),a.should.equal((new h("9b56d519ccd9e1e5b2a725e186184cdc68de0731")).hexdigest(),"f042dc98a62cbad68dbe21f11bbc1e9d416d2bf6"),a.should.equal((new h("MD5abZRVSXZVRcasdfasdddddddddddddddds+BNRJFSLKJFN+SEONBBJFJXLKCJFSE)RUNVXDLILKVJRN)#NVFJ)WVFWRW#)NVS$Q=$dddddddddddddWV;no9wurJFSE)RUNVXDLILKVJRN)#NVFJ)WVFWRW#)NVS$Q=$dddddddddddddWV;no9wurJFSE)RUNVXDLILKVJRN)#NVFJ)WVFWRW#)NVS$Q=$dddddddddddddWV;no9wurJFSE)RUNVXDLILKVJRN)#NVFJ)WVFWRW#)NVS$Q=$dddddddddddddWV;no9wuraddddddasdfasdfd")).hexdigest(),"662dbf4ebc9cdb4224766e87634e5ba9e6de672b")}}),h}();return a.SHA1=b,a}().SHA1,Utils=function(){var a={};return a.read_byte=function(a,b){var c=Ti.Codec.decodeNumber({source:a,position:b||0,type:Ti.Codec.TYPE_BYTE,byteOrder:Ti.Codec.BIG_ENDIAN});return c<0&&(c+=256),c},a.read_2byte=function(a,b){var c=Ti.Codec.decodeNumber({source:a,position:b||0,type:Ti.Codec.TYPE_SHORT,byteOrder:Ti.Codec.BIG_ENDIAN});return c<0&&(c+=65536),c},a.read_8byte=function(a,b){var c=Ti.Codec.decodeNumber({source:a,position:b||0,type:Ti.Codec.TYPE_LONG,byteOrder:Ti.Codec.BIG_ENDIAN});return c<0&&(c+=0x10000000000000000),c},a.byte_length=function(a){var b=Ti.createBuffer({length:65536}),c=Ti.Codec.encodeString({source:a,dest:b});return c},a.trim=function(a){return String(a).replace(/^\s+|\s+$/g,"")},a}(),events=function(){function c(){}var a={},b=Array.isArray;a.EventEmitter=c;var d=10;return c.prototype.setMaxListeners=function(a){this._events||(this._events={}),this._maxListeners=a},c.prototype.emit=function(){var a=arguments[0];if(!this._events)return!1;var c=this._events[a];if(!c)return!1;var d,e,f;if(typeof c=="function"){switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:e=arguments.length,d=new Array(e-1);for(f=1;f<e;f++)d[f-1]=arguments[f];c.apply(this,d)}return!0}if(b(c)){e=arguments.length,d=new Array(e-1);for(f=1;f<e;f++)d[f-1]=arguments[f];var g=c.slice();for(f=0,e=g.length;f<e;f++)g[f].apply(this,d);return!0}return!1},c.prototype.addListener=function(a,c){if("function"!=typeof c)throw new Error("addListener only takes instances of Function");this._events||(this._events={}),this.emit("newListener",a,c);if(!this._events[a])this._events[a]=c;else if(b(this._events[a])){this._events[a].push(c);if(!this._events[a].warned){var e;this._maxListeners!==undefined?e=this._maxListeners:e=d,e&&e>0&&this._events[a].length>e&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),console.trace())}}else this._events[a]=[this._events[a],c];return this},c.prototype.on=c.prototype.addListener,c.prototype.once=function(a,b){function d(){c.removeListener(a,d),b.apply(this,arguments)}if("function"!=typeof b)throw new Error(".once only takes instances of Function");var c=this;return d.listener=b,c.on(a,d),this},c.prototype.removeListener=function(a,c){if("function"!=typeof c)throw new Error("removeListener only takes instances of Function");if(!this._events||!this._events[a])return this;var d=this._events[a];if(b(d)){var e,f=-1;for(e=0,length=d.length;e<length;e++)if(d[e]===c||d[e].listener&&d[e].listener===c){f=e;break}if(f<0)return this;d.splice(f,1),d.length===0&&delete this._events[a]}else(d===c||d.listener&&d.listener===c)&&delete this._events[a];return this},c.prototype.removeAllListeners=function(a){return arguments.length===0?(this._events={},this):(a&&this._events&&this._events[a]&&(this._events[a]=null),this)},c.prototype.listeners=function(a){return this._events||(this._events={}),this._events[a]||(this._events[a]=[]),b(this._events[a])||(this._events[a]=[this._events[a]]),this._events[a]},a}(),debug=function(a){Ti.API.debug(a)},CONNECTING=0,OPEN=1,CLOSING=2,CLOSED=3,BUFFER_SIZE=65536,CLOSING_TIMEOUT=1e3,WebSocket=function(a,b,c,d){this.url=a;if(!this._parse_url())throw"Wrong url scheme for WebSocket: "+this.url;this.origin=c||String.format("http://%s:%s/",this._host,this._port),this.protocols=b,this.extensions=d,this.readyState=CONNECTING,this._masking_disabled=!1,this._headers=[],this._pong_received=!1,this._readBuffer="",this._socketReadBuffer=undefined,this._closingTimer=undefined,this._handshake=undefined,this._socket=undefined,this._connect()};exports.WebSocket=WebSocket,WebSocket.prototype=new events.EventEmitter,WebSocket.prototype.onopen=function(){},WebSocket.prototype.onmessage=function(){},WebSocket.prototype.onerror=function(){},WebSocket.prototype.onclose=function(){},WebSocket.prototype._parse_url=function(){var a=this.url.match(/^([a-z]+):\/\/([\w.]+)(:(\d+)|)(.*)/i);return!a||a[1]!=="ws"?!1:(this._host=a[2],this._port=a[4]||80,this._path=a[5],!0)};var make_handshake_key=function(){var a,b="";for(a=0;a<16;++a)b+=String.fromCharCode(Math.random()*255+1);return Utils.trim(Ti.Utils.base64encode(b))},make_handshake=function(a,b,c,d,e,f){return str="GET "+b+" HTTP/1.1\r\n",str+="Host: "+a+"\r\nUpgrade: websocket\r\nConnection: Upgrade\r\n",str+="Sec-WebSocket-Key: "+f+"\r\n",str+="Origin: "+c+"\r\n",str+="Sec-WebSocket-Origin: "+c+"\r\n",str+="Sec-WebSocket-Version: 7\r\n",d&&d.length>0&&(str+="Sec-WebSocket-Protocol: "+d.join(",")+"\r\n"),e&&e.length>0&&(str+="Sec-WebSocket-Extensions: "+e.join(",")+"\r\n"),str+"\r\n"};WebSocket.prototype._send_handshake=function(){this._handshake=make_handshake_key();var a=make_handshake(this._host,this._path,this.origin,this.protocols,this.extensions,this._handshake);return this._socket.write(Ti.createBuffer({value:a}))>0},WebSocket.prototype._read_http_headers=function(){var a="",b=Ti.createBuffer({length:BUFFER_SIZE}),c=10;for(;;){var d=this._socket.read(b);if(d>0){var e=a.length;a+=Ti.Codec.decodeString({source:b,charset:Ti.Codec.CHARSET_ASCII});var f=a.match(/\r\n\r\n/);if(f){var g=f.index+4-e;a=a.substring(0,g-2),this.buffer=Ti.createBuffer({length:BUFFER_SIZE}),this.bufferSize=d-g,this.buffer.copy(b,0,g,this.bufferSize);break}}else{debug("read_http_headers: timeout"),--c;if(c<0)return!1}b.clear()}return b.clear(),this.headers=a.split("\r\n"),!0};var extract_headers=function(a){var b={};return a.forEach(function(a){var c=a.indexOf(":");if(c>0){var d=Utils.trim(a.slice(0,c)),e=Utils.trim(a.slice(c+1));b[d]=e}}),b},handshake_reponse=function(a){return(new SHA1(a+"258EAFA5-E914-47DA-95CA-C5AB0DC85B11")).base64digest()};WebSocket.prototype._check_handshake_response=function(){var a=this.headers.shift();if(a!=="HTTP/1.1 101 Switching Protocols")return debug("mismatch protocol version"),!1;var b=extract_headers(this.headers);return!b.Upgrade||!b.Connection||!b["Sec-WebSocket-Accept"]?!1:b.Upgrade.toLowerCase()!=="websocket"||b.Connection.toLowerCase()!=="upgrade"||b["Sec-WebSocket-Accept"]!==handshake_reponse(this._handshake)?!1:(this.readyState=OPEN,!0)},WebSocket.prototype._create_frame=function(a,b,c){typeof c=="undefined"&&(c=!0);if(c===!1&&a>=8&&a<=15)return!1;var d=b||"",e=Utils.byte_length(d),f=2,g=6;125<e&&e<=BUFFER_SIZE?f+=2:BUFFER_SIZE<e&&(f+=8),this._masking_disabled||(f+=4);var h=Ti.createBuffer({length:e+f+g}),i=0,j=a;c&&(j|=128),Ti.Codec.encodeNumber({source:j,dest:h,position:i++,type:Ti.Codec.TYPE_BYTE});if(e<=125){var k=e;this._masking_disabled||(k|=128),Ti.Codec.encodeNumber({source:k,dest:h,position:i++,type:Ti.Codec.TYPE_BYTE})}else Ti.Codec.encodeNumber({source:255,dest:h,position:i++,type:Ti.Codec.TYPE_BYTE}),Ti.Codec.encodeNumber({source:e,dest:h,position:i,type:Ti.Codec.TYPE_LONG,byteOrder:Ti.Codec.BIG_ENDIAN}),i+=8;return i=this._mask_payload(h,i,d),h.length=i,h},WebSocket.prototype._mask_payload=function(a,b,c){if(!this._masking_disabled){var d,e=[];for(d=0;d<4;++d){var f=Math.floor(Math.random()*255)&255;e.push(f),Ti.Codec.encodeNumber({source:f,dest:a,position:b++,type:Ti.Codec.TYPE_BYTE})}var g=Ti.createBuffer({length:BUFFER_SIZE}),h=Ti.Codec.encodeString({source:c,dest:g});g.length=h;var i=Ti.Codec.decodeString({source:g,charset:Ti.Codec.CHARSET_ASCII});a.length<h&&(a.length=i.length);for(d=0;d<i.length;++d)Ti.Codec.encodeNumber({source:i.charCodeAt(d)^e[d%4],dest:a,position:b++,type:Ti.Codec.TYPE_BYTE});return b}var j=Ti.Codec.encodeString({source:c,dest:a,destPosition:b});return j+b};var parse_frame=function(a,b){if(b<3)return undefined;var c=Utils.read_byte(a,0),d=!!(c&128),e=c&15,f=Utils.read_byte(a,1),g=!!(f&128),h=f&127,i=2;switch(h){case 126:h=Utils.read_2byte(a,i),i+=2;break;case 127:h=Utils.read_8byte(a,i),i+=8}if(h+i>b)return undefined;var j=Ti.Codec.decodeString({source:a,position:i,length:h,charset:Ti.Codec.CHARSET_UTF8});return{fin:d,opcode:e,payload:j,size:h+i}};WebSocket.prototype.send=function(a){if(a&&this.readyState===OPEN){var b=Ti.createBuffer({value:a}),c=Ti.Codec.decodeString({source:b,charset:Ti.Codec.CHARSET_ASCII}),d=c.length;if(d<BUFFER_SIZE){var e=this._create_frame(1,c),f=this._socket.write(e);return 0<f}var g=!0,h=0;while(h<d){if(d<h+BUFFER_SIZE)break;fragment=c.substring(h,BUFFER_SIZE);if(fragment.length<1)return!0;var i=128;g&&(i=1,g=!1),e=this._create_frame(i,fragment,!1);if(this._socket.write(e)<1)return!1;h+=BUFFER_SIZE}return fragment=c.substring(h,d),fragment.length<1?!0:(e=this._create_frame(128,fragment,!0),this._socket.write(e)<1?!1:!0)}return!1},WebSocket.prototype._socket_close=function(){this._closingTimer&&clearTimeout(this._closingTimer),this._closingTimer=undefined,this._readBuffer="",this._socketReadBuffer=undefined;var a;this.readyState===CLOSING?(this.readyState=CLOSED,this._socket.close(),a={code:1e3,wasClean:!0,reason:""},this.emit("close",a),this.onclose(a)):this.readyState!==CLOSED&&(this._socket.close(),this.readyState=CLOSED,a={advice:"reconnect"},this.emit("error",a),this.onerror(a)),this._socket=undefined},WebSocket.prototype._read_callback=function(a){var b=this,c=function(){b._socketReadBuffer.clear(),Ti.Stream.read(b._socket,b._socketReadBuffer,function(a){b._read_callback(a)})};if("undefined"!=typeof a){if(0===a.bytesProcessed)return c();if(-1===a.bytesProcessed)return this._socket_close(),undefined;"undefined"==typeof this.buffer?(this.buffer=this._socketReadBuffer.clone(),this.bufferSize=a.bytesProcessed):(this.buffer.copy(this._socketReadBuffer,this.bufferSize,0,a.bytesProcessed),this.bufferSize+=a.bytesProcessed,this.buffer.length+=a.bytesProcessed,this._socketReadBuffer.clear())}var d=parse_frame(this.buffer,this.bufferSize);if("undefined"==typeof d)return c();if(d.size<this.bufferSize){var e=Ti.createBuffer({length:BUFFER_SIZE});this.bufferSize-d.size>0&&e.copy(this.buffer,0,d.size,this.bufferSize-d.size),this.buffer.clear(),this.buffer=e,this.bufferSize-=d.size}else this.buffer.clear(),this.bufferSize=0;switch(d.opcode){case 0:case 1:case 2:d.fin?(this.emit("message",{data:this._readBuffer+d.payload}),this.onmessage({data:this._readBuffer+d.payload}),this._readBuffer=""):this._readBuffer+=d.payload;break;case 8:this.readyState===CLOSING?this._socket_close():(this.readyState=CLOSING,this._socket.write(this._create_frame(8)),this._closingTimer=setTimeout(function(){b._socket_close()},CLOSING_TIMEOUT));break;case 9:this._socket.write(this._create_frame(10,d.payload));break;case 10:this._pong_received=!0}this._read_callback()},WebSocket.prototype._error=function(a,b){this.buffer&&this.buffer.clear(),this.buffer=undefined,this.bufferSize=0,this.readyState=CLOSED;if(this._socket){try{this._socket.close()}catch(c){}this._socket=undefined}var d={wasClean:!0,code:"undefined"==typeof a?1e3:a,advice:"reconnect",reason:b};this.emit("error",d),this.onerror(d)},WebSocket.prototype._raise_protocol_error=function(a){this._error(1002,a)},WebSocket.prototype.close=function(a,b){if(this.readyState===OPEN){this.readyState=CLOSING;var c=Ti.createBuffer({length:BUFFER_SIZE});Ti.Codec.encodeNumber({source:a||1e3,dest:c,position:0,type:Ti.Codec.TYPE_SHORT,byteOrder:Ti.Codec.BIG_ENDIAN});if(b){var d=Ti.Codec.encodeString({source:b,dest:c,destPosition:2});c.length=2+d}else c.length=2;var e=Ti.Codec.decodeString({source:c,charset:Ti.Codec.CHARSET_ASCII});this._socket.write(this._create_frame(8,e));var f=this;this._closingTimer=setTimeout(function(){f._socket_close()},CLOSING_TIMEOUT)}},WebSocket.prototype._connect=function(){if(this.readyState===OPEN||this.readyState===CLOSING)return!1;var a=this;this._socket=Ti.Network.Socket.createTCP({host:this._host,port:this._port,mode:Ti.Network.READ_WRITE_MODE,connected:function(b){var c;c=a._send_handshake();if(!c)return a._raise_protocol_error("send handshake");c=a._read_http_headers();if(!c)return a._raise_protocol_error("parse http header");c=a._check_handshake_response();if(!c)return a._raise_protocol_error("wrong handshake");a._readBuffer="",a._socketReadBuffer=Ti.createBuffer({length:BUFFER_SIZE}),a.readyState=OPEN,a.emit("open"),a.onopen(),a._read_callback()},closed:function(){a._socket_close(),a.buffer&&a.buffer.clear(),a.buffer=undefined,a.bufferSize=0},error:function(b){var c;"undefined"!=typeof b&&(c=b.error),a._error(1e3,c)}}),this._socket.connect()}